model new
model large-strain off
zone create brick size 6 6 12 point 0 (0,0,0) point 1 (0.03, 0.0, 0) point 2 (0, 0.03, 0) point 3 (0, 0, 0.06)

zone face skin

zone cmodel assign columnar-basalt

[global H = 0.06]
[global r = 0.015]

;confining pressure, strain rate, initial pore pressure
[global conf = -13.5e6] ; confinement must be negative or zero
[global edot = 5.e-7] ; loading velocity
[global vz = edot * H]
[global u0 = 3.5e6] ;initial pore pressure

;mechanical parameters
[global young = 1.25e9]
[global dip_angle = 30]
[global S = 1e20] ;joint spacing
[global kn = 60e3] ;normal joint stiffness
[global ks = 60e3] ;shear joint stiffness

;fluid
model configure fluid-flow
zone fluid cmodel assign isotropic
zone fluid property permeability 2.5e-20
zone fluid property fluid-density 1000
zone fluid property biot-modulus 12.5e9 ;12 GPa for solid grain bulk mod (Keller, 2017)
zone fluid property pore-pressure-generation on 
zone fluid property porosity 0.16 
zone fluid property mobility-coefficient 5e-17 ; Permeability / viscosity
zone gridpoint initialize pore-pressure [u0]

;boundary and initial stress conditions
zone face apply velocity-z [-vz] range group 'Top'
;zone gridpoint fix velocity-y 0 range position-z 0.06 0.063
;zone gridpoint fix velocity-x 0 range position-z 0.06 0.063
zone face apply velocity-z 0 range group 'Bottom'

zone initialize stress xx [conf] yy [conf] zz [conf] xy 0 xz 0 yz 0
zone face apply stress-normal [conf] range group 'South' or 'North'
zone face apply stress-normal [conf] range group 'East' or 'West'


;mechanical parameters
zone property tension 1e7
zone property young [young]
zone property poisson 0.35
zone initialize density 2600

;joint parameters
zone property dip-3 [dip_angle]
zone property dip-direction-3 10
zone property joint-cohesion-3 0.5e6
zone property joint-tension-3 0
zone property table-joint-friction-3 'fric-1'

zone property cohesion 0.5e7
zone property friction 25.5

table 'fric-1' add (0 15.5) (2e-3 15.5) (1.3e-2 12.5) 
table 'coh-1' add (0 0.5e6) (2e-3 0.5e6) (1.3e-2 0)


zone property space-1 [S]
zone property stiffness-normal-1 [kn]
zone property stiffness-shear-1 [ks]
zone property flag-matrix-plastic false

;axial stress
[global gps_top = list(gp.list)(gp.isgroup(::gp.list,'Top'))]
[global area = 0.03 * 0.03]
fish define stress_top
  local force_top = list.sum(gp.force.unbal(::gps_top)->z)
  local stress_top = (force_top/area) * 1e-6
  global q = stress_top + conf * 1e-6
end

[global gp_top1 = gp.near(0.0,0.0,0.06)]
[global zlength = 0.06]
fish define strain_zz
  global strain_zz = 100.0*1.0*gp.disp.z(gp_top1)/zlength
end

history interval 100
fish history stress_top
fish history strain_zz
fish history q
zone history pore-pressure position (0,0,0.06)
model cycle 300000
