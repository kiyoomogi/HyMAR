model new
model large-strain off

;mesh
zone import 'decovalex_mesh.f3grid'
zone face skin

zone cmodel assign columnar-basalt


;sample dimensions
[global H = 0.06]
[global r = 0.015]
[global h = H/22.0]
[global Hh = H + 0.003]

;confining pressure, strain rate, initial pore pressure
[global conf = -12e6] ; confinement must be negative or zero
[global edot = 5.e-6] ; loading velocity
[global vz = edot * H]
[global u0 = 2e6] ;initial pore pressure

;mechanical parameters
[global young = 1e9]
[global S = 1e-5] ;joint spacing$$
[global kn = 0] ;normal joint stiffness
[global ks = 0] ;shear joint stiffness
[global coh1 = 0.5e6] ;cohesion joint
[global fric1 = 15]   ;friction joint
[global fric1_res = fric1 * 0.7] ;residual friction joint


;fluid
model configure fluid-flow
zone fluid cmodel assign isotropic
zone fluid property permeability 5e-20
zone fluid property fluid-density 1000
zone fluid property biot-modulus 7e9 ;12 GPa for solid grain bulk mod (Keller, 2017)
zone fluid property pore-pressure-generation on 
zone fluid property porosity 0.16            ; Porosity
zone fluid property mobility-coefficient 5e-17 ; Permeability / viscosity
zone gridpoint initialize pore-pressure [u0]

;boundary and initial stress conditions
zone face apply velocity-z [-vz] range group 'Top'
;zone gridpoint fix velocity-x range union position-z [H] [Hh] position-z 0 [h]
;zone gridpoint fix velocity-y range union position-z [H] [Hh] position-z 0 [h]
zone face apply velocity-z 0 range group 'Bottom'
zone initialize stress xx [conf] yy [conf] zz [conf] xy 0 xz 0 yz 0
zone face apply stress-normal [conf] range group 'South' or 'North'

;axial stress
[global gps_top = list(gp.list)(gp.isgroup(::gp.list,'Top'))]
[global area = 3.14*0.015*0.015]
fish define stress_top
  local force_top = list.sum(gp.force.unbal(::gps_top)->z)
  local stress_top = (force_top/area) * 1e-6
  global q = stress_top + conf * 1e-6
end

[global gp_top1 = gp.near(0.0,0.0,0.06)]
[global zlength = 0.063]
fish define strain_zz
  global strain_zz = 100.0*1.0*gp.disp.z(gp_top1)/zlength
end




zone initialize density 2600

;mechanical parameters
zone property cohesion 5e6 ;very hgih
zone property friction 30
zone property tension 1e6
zone property young [young]
zone property poisson 0.35


;joint parameters
zone property dip-1 30
zone property dip-direction-1 0
zone property joint-cohesion-1 0.5e6
zone property joint-dilation-1 0
zone property joint-tension-1 1e6
zone property space-1 [S]
zone property stiffness-normal-1 [kn]
zone property stiffness-shear-1 [ks]
;zone property table-joint-cohesion-1 'coh-1'
zone property table-joint-friction-1 'fric-1'
zone property flag-matrix-plastic off

table 'coh-1' add (0 [coh1]) (0.0001 0)
table 'fric-1' add (0 [fric1]) (1e-10 [fric1_res])


history interval 100
fish history stress_top
fish history strain_zz
fish history q

model cycle 20000

model save 'comba_model'
